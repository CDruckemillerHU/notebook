<br />
<div class="row">
  <div class="col s12">
    <ul class="collapsible popout">
      <li>
        <div class="collapsible-header blue white-text">
          <i class="material-icons">share</i>
          Click here to share a page
        </div>
        <div class="collapsible-body white">
          <%= form_for [current_user, ContentPageShare.new(user: current_user)] do |f| %>
            <div class="row">
              <div class="col s12 m6 l6">
                <div class="input-field col s12">
                  <%= f.select :content_page do %>
                    <% @current_user_content.each do |content_type, content_list| %>
                      <optgroup label="<%= content_type.pluralize %>">
                        <% content_list.each do |content| %>
                          <option value="<%= content_type %>-<%= content.id %>"><%= content.name %></option>
                        <% end %>
                      </optgroup>
                    <% end %>
                  <% end %>
                  <label>1. Select a page to share</label>
                  <div class="helper-text">
                    Only pages you've marked "public" may be shared.
                  </div>
                </div>
              </div>
              <div class="col s12 m6 l6">
                <div class="input-field">
                  <%= f.text_area :message, class: 'materialize-textarea' %>
                  <%= f.label :message, '2. Write a question or message about your page.' %>
                </div>
              </div>
              <div class="col s12">
                <%= f.submit 'Share', class: 'btn green white-text right' %>
              </div>
            </div>
          <% end %>
        </div>
      </li>
    </ul>
  </div>
</div>

<% @feed.each do |share| %>
  <% content = share.content_page %>
  <div class="row">
    <div class="col s12">
      <%= link_to share.user, class: "#{User.color}-text" do %>
        <%= image_tag share.user.image_url(size=20), class: 'left circle', style: 'margin-right: 8px;' %>
        <%= share.user.display_name %>
      <% end %>
      shared a
      <%= content.class.name.downcase %>:
      <%= link_to content.name, content, class: "#{content.class.color}-text text-darken-1" %>.
      <span class="right">
        <%= link_to [share.user, share], class: 'grey-text' do %>
          <%= time_ago_in_words share.created_at %> ago
        <% end %>
      </span>
    </div>
  </div>
  <div class="hoverable card row <%= content.class.color %> clearfix" style="height: 400px">
    <div class="col s12 m6 l6">
      <div class="card-image" style="height: 300px">
        <%= image_tag content.random_public_image(format: :small), style: 'height: 300px' %>
        <span class="card-title">
          <%= link_to content do %>
            <i class="material-icons tiny <%= content.class.color %>-text"><%= content.class.icon %></i>
            <span class="white-text bordered-text"><%= content.name %></i>
          <% end %>
        </span>
      </div>

      <div class="card-content white" style="height: 100px">
        <span class="right">

          <a class='dropdown-trigger' href='#' data-target='dropdown-<%= content.class.name %>-<%= content.id %>'>
            <i class="material-icons">more_vert</i>
          </a>
          <ul id='dropdown-<%= content.class.name %>-<%= content.id %>' class='dropdown-content'>
            <li>
              <%= link_to [share.user, share] do %>
                <i class="material-icons left">link</i>
                Permalink
              <% end %>
            </li>
            <li>
              <%= link_to content do %>
                <i class="material-icons left"><%= content.class.icon %></i>
                View this <%= content.class.name.downcase %>
              <% end %>
            </li>
            <li class="divider" tabindex="-1"></li>
            <li>
              <%= link_to '#' do %>
                <i class="material-icons">delete</i>
                Delete this share
              <% end %>
            </li>
          </ul>

        </span>
        <%= strip_tags content.description.presence || "A #{content.class.name.downcase}" %>
      </div>
    </div>
    <div class="col s12 m6 l6 <%= content.class.color %> lighten-5">
      <div class="card-content white" style="height: 400px; overflow-y: auto">
        <div class="green lighten-5" style="padding: 10px;">
          <blockquote>
            <%= simple_format share.message %>
          </blockquote>
          <div class="metadata">
            <%= link_to share.user, class: "#{User.color}-text" do %>
              <%= image_tag share.user.image_url(size=20), class: 'left circle', style: 'margin-right: 8px;' %>
              <%= share.user.display_name %>
            <% end %>
            <span class="grey-text">
              <%= time_ago_in_words (DateTime.now - 5.hours) %> ago
            </span>
          </div>
        </div>
        
        <%= form_for ShareComment.new do |f| %>
          <div class="input-field comment-form">
            <%= f.label :message, 'Leave a message' %>
            <%= f.hidden_field :content_page_share_id, value: share.id %>
            <%= f.text_area :message, class: 'materialize-textarea' %>
            <%= f.submit 'Comment', class: 'btn right green white-text submit-button' %>
          </div>
        <% end %>

        <br /><br />
        
        <div class="row">
          <% share.share_comments.each do |comment| %>
            <% if comment.from_op?(share) %>
              <div class="col s12 m10 l9">
                <div class="green lighten-5 comment">
            <% else %>
              <div class="col s12 m10 offset-m2 l9 offset-l3">
                <div class="blue lighten-5 comment">
            <% end %>

                  <%= simple_format comment.message %>
                  <div class="metadata">
                    <%= link_to comment.user, class: "#{User.color}-text" do %>
                      <%= image_tag comment.user.image_url(size=20), class: 'left circle', style: 'margin-right: 8px;' %>
                      <%= comment.user.display_name %>
                    <% end %>
                    <span class="grey-text">
                      <%= time_ago_in_words comment.created_at %> ago
                    </span>
                  </div>

                </div>
              </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <br /><br />
<% end %>
