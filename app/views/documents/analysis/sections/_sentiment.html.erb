<h5 class="grey-text">Sentiment</h5>
<div class="row">
  <div class="col s12 m6">
    <div class="card">
      <div class="card-content blue lighten-4">
        <div class="card-title">
          Overall <%= analysis.sentiment_label %>
        </div>
        <span style="font-size: 32px; margin-right: 10px;" class="blue-text left center">
          <i class="material-icons large">face</i><br />
          <span style="position: relative; top: -25px;">
            <%= analysis.sentiment_score %>
          </span>
        </span>
        <p>
          Some text
        </p>
        <p>
          Score: <%= analysis.sentiment_score %>
        </p>
        <div class="clearfix"></div>
      </div>
    </div>
  </div>

  <div class="col s12 m6">
    <div class="card">
      <div class="card-content" style="overflow: hidden;">
        <div class="card-title">Evoked emotions</div>
        <div id="graph-emotions"></div>
      </div>
    </div>
  </div>
</div>

<style>
.bar {
  fill: #5f89ad;
}

.axis {
  font-size: 13px;
}
.label {
  font-size: 11px;
}

.axis path,
.axis line {
  fill: none;
  display: none;
}
</style>

<script type="text/javascript">
$(document).ready(function () {
  var data = [
    {
        "name": "Joy",
        "value": <%= (100 * analysis.joy_score).round(1) %>,
    },
    {
        "name": "Sadness",
        "value": <%= (100 * analysis.sadness_score).round(1) %>,
    },
    {
        "name": "Fear",
        "value": <%= (100 * analysis.fear_score).round(1) %>,
    },
    {
        "name": "Disgust",
        "value": <%= (100 * analysis.disgust_score).round(1) %>,
    },
    {
        "name": "Anger",
        "value": <%= (100 * analysis.anger_score).round(1) %>,
    }
  ];

  //sort bars based on value
  data = data.sort(function (a, b) {
    return d3.ascending(a.value, b.value);
  })

  var margin = {
    top: 10,
    right: 0,
    bottom: 30,
    left: 60
  };

  var width = 300,
      height = 300;

  var svg = d3.select("#graph-emotions").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var x = d3.scaleLinear()
    .range([0, width])
    .domain([0, d3.max(data, function (d) {
      return d.value;
    })]);

  var y = d3.scalePoint()
    .rangeRound([height, 0], .1)
    .domain(data.map(function (d) {
      return d.name;
    }));

  //make y axis to show bar names
  var yAxis = d3.axisLeft()
    .scale(y)
    .tickSize(0); // no tick marks

  var gy = svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)

  var bars = svg.selectAll(".bar")
    .data(data)
    .enter()
    .append("g")

  //append rects
  bars.append("rect")
    .attr("class", "bar")
    .attr("y", function (d) {
        return y(d.name) - 10;
    })
    .attr("height", 30)
    .attr("x", 0)
    .attr("width", function (d) {
        return x(d.value);
    });

  //add a value label to the right of each bar
  bars.append("text")
    .attr("class", "label")
    .attr("y", function (d) {
        return y(d.name) + 20;
    })
    .attr("x", function (d) {
        return -25;
    })
    .text(function (d) {
        return d.value;
    });
});
</script>
