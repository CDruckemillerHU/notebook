<h5 class="grey-text">Entities</h5>
<div class="row">
  <% analysis.document_entities.order('entity_type').each do |entity| %>
    <% entity_class = entity.entity_type.constantize %>
    <div class="col s12 m6">
      <div class="card">
        <div class="card-image waves-effect waves-block waves-light">
          <%# todo page image if matched to a page + images exist %>
          <%= image_tag 'card-headers/' + entity_class.name.downcase.pluralize + '.jpg', class: 'activator' %>
        </div>
        <div class="card-content">
          <span class="card-title activator <%= entity_class.color %>-text">
            <i class="material-icons left"><%= entity_class.icon %></i>
            <%= entity.text %>
            <i class="material-icons right black-text">more_vert</i>
          </span>
          <p>
            Relevance: <%= entity.relevance %>
          </p>
        </div>
        <div class="card-reveal">
          <span class="card-title <%= entity_class.color %>-text">
            <i class="material-icons left"><%= entity_class.icon %></i>
            <%= entity.text %>
            <i class="material-icons right black-text">close</i>
          </span>
          <div id="graph-character-emotions-<%= entity.id %>"></div>
          <ul class="help-text">
            <li>Sentiment: <%= entity.sentiment_label %> (<%= entity.sentiment_score %>)</li>
            <li>Joy: <%= entity.joy_score %></li>
            <li>Sadness: <%= entity.sadness_score %></li>
            <li>Fear: <%= entity.fear_score %></li>
            <li>Disgust: <%= entity.disgust_score %></li>
            <li>Anger: <%= entity.anger_score %></li>
          </ul>
        </div>
        <div class="card-action">
          <a href="#" class="<%= entity_class.color %>-text">View Notebook.ai page</a>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function () {
        var emotions_chart = Highcharts.chart('graph-character-emotions-<%= entity.id %>', {
          chart: {
              polar: true,
              type: 'line'
          },
          title: {
              text: 'Emotional range'
          },
          xAxis: {
              categories: ['Joy', 'Sadness', 'Fear', 'Disgust', 'Anger'],
              tickmarkPlacement: 'on',
              lineWidth: 0
          },
          yAxis: {
              lineWidth: 0,
              min: 0,
              max: 100
          },
          legend: {
            enabled: false
          },
          series: [
              {
                name: '<%= entity.text %>',
                data: <%=
                  [
                    (100 * entity.joy_score).round(1),
                    (100 * entity.sadness_score).round(1),
                    (100 * entity.fear_score).round(1),
                    (100 * entity.disgust_score).round(1),
                    (100 * entity.anger_score).round(1)
                  ]
                %>,
                pointPlacement: 'on'
              }
          ]
        });
      })
      </script>

  <% end %>

  <div class="col s12 m12">
    <div class="card">
      <div class="card-content">
        <div id="graph-character-emotions"></div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function () {
  var emotions_chart = Highcharts.chart('graph-character-emotions', {
    chart: {
        polar: true,
        type: 'line'
    },
    title: {
        text: 'Ensemble emotional range'
    },
    xAxis: {
        categories: ['Joy', 'Sadness', 'Fear', 'Disgust', 'Anger'],
        tickmarkPlacement: 'on',
        lineWidth: 0
    },
    yAxis: {
        lineWidth: 0,
        min: 0,
        max: 100
    },
    legend: {
        align: 'right',
        verticalAlign: 'top',
        y: 70,
        layout: 'vertical'
    },

    series: [
      <% analysis.document_entities.where(entity_type: 'Character').each do |entity| %>
        {
          name: '<%= entity.text %>',
          data: <%=
            [
              (100 * entity.joy_score).round(1),
              (100 * entity.sadness_score).round(1),
              (100 * entity.fear_score).round(1),
              (100 * entity.disgust_score).round(1),
              (100 * entity.anger_score).round(1)
            ]
          %>,
          pointPlacement: 'on'
        },
      <% end %>
    ]
  });
})
</script>
